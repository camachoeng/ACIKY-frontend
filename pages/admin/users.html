<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="{{basePath}}/images/logo/logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Gestion de usuarios - Admin ACIKY" />
    <title>Usuarios - Admin ACIKY</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body class="min-h-screen">
    {{> header}}
    {{> admin-nav}}

    <main class="pb-12">
      <section class="px-6 py-8">
        <div class="flex items-center justify-between mb-8">
          <h1 class="text-2xl font-bold text-primary-dark" data-i18n="title">Usuarios</h1>
          <button id="createUserBtn" class="bg-primary text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-primary-dark transition-colors flex items-center gap-1">
            <span class="material-symbols-outlined text-sm">add</span>
            <span data-i18n="newButton">Nuevo</span>
          </button>
        </div>

        <!-- Search -->
        <div class="relative mb-4">
          <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg pointer-events-none">search</span>
          <input id="usersSearch" type="search" placeholder="Buscar por nombre o email..."
                 class="w-full pl-11 pr-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm bg-white" />
        </div>

        <!-- Users Table -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-slate-50 border-b border-slate-100">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase" data-i18n="table.image">Foto</th>
                  <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase" data-i18n="table.user">Usuario</th>
                  <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase" data-i18n="table.email">Email</th>
                  <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase" data-i18n="table.role">Rol</th>
                  <th class="px-6 py-3 text-right text-xs font-bold text-slate-500 uppercase" data-i18n="table.actions">Acciones</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- User Modal -->
      <div id="userModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="fixed inset-0 bg-black/50" id="userModalOverlay"></div>
        <div class="relative inset-x-4 my-8 max-w-lg mx-auto bg-white rounded-3xl p-8 shadow-xl">
          <h2 id="userModalTitle" class="text-xl font-bold text-primary-dark mb-6">Nuevo Usuario</h2>
          <form id="userForm" class="space-y-4">
            <input type="hidden" id="userId" />
            <!-- Profile Image -->
            <div>
              <label class="block text-sm font-medium text-primary-dark mb-2" data-i18n="modal.profileImage">Foto de Perfil</label>
              <div class="flex items-center gap-4">
                <img id="userProfileImagePreview" src="/images/default-avatar.png" alt="Preview" class="w-16 h-16 rounded-full object-cover border-2 border-slate-200" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle fill=%22%23e2e8f0%22 cx=%2250%22 cy=%2250%22 r=%2250%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2220%22>ðŸ‘¤</text></svg>'" />
                <div class="flex-1">
                  <input type="file" id="userImageUpload" accept="image/jpeg,image/png,image/webp" class="hidden" />
                  <button type="button" id="userImageUploadBtn" class="px-4 py-2 bg-slate-100 text-slate-700 text-sm font-medium rounded-lg hover:bg-slate-200 transition-colors">
                    <span data-i18n="modal.uploadImage">Subir Imagen</span>
                  </button>
                  <p class="text-xs text-slate-400 mt-1" data-i18n="modal.imageHint">JPG, PNG o WEBP. Max 5MB</p>
                  <div id="userUploadProgress" class="hidden mt-2">
                    <div class="w-full bg-slate-200 rounded-full h-1.5">
                      <div class="bg-primary h-1.5 rounded-full transition-all duration-300" style="width: 0%" id="userUploadProgressBar"></div>
                    </div>
                  </div>
                  <p id="userUploadError" class="hidden text-xs text-red-500 mt-1"></p>
                </div>
              </div>
              <input type="hidden" id="userProfileImageUrl" />
            </div>

            <div>
              <label for="userName" class="block text-sm font-medium text-primary-dark mb-1" data-i18n="modal.name">Nombre</label>
              <input type="text" id="userName" required minlength="2" maxlength="100"
                     class="w-full px-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                     data-i18n-placeholder="modal.namePlaceholder" placeholder="Nombre del usuario" />
            </div>
            <div>
              <label for="userLastName" class="block text-sm font-medium text-primary-dark mb-1" data-i18n="modal.lastName">Apellido</label>
              <input type="text" id="userLastName" required minlength="2" maxlength="100"
                     class="w-full px-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                     data-i18n-placeholder="modal.lastNamePlaceholder" placeholder="Apellido del usuario" />
            </div>
            <div>
              <label for="userSpiritualName" class="block text-sm font-medium text-primary-dark mb-1" data-i18n="modal.spiritualName">Nombre Espiritual <span class="text-slate-400 font-normal">(opcional)</span></label>
              <input type="text" id="userSpiritualName" minlength="2" maxlength="100"
                     class="w-full px-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                     data-i18n-placeholder="modal.spiritualNamePlaceholder" placeholder="Nombre espiritual (opcional)" />
            </div>
            <div>
              <label for="userEmail" class="block text-sm font-medium text-primary-dark mb-1">Email</label>
              <input type="email" id="userEmail" required
                     class="w-full px-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                     placeholder="correo@ejemplo.com" />
            </div>
            <div id="passwordFields">
              <label for="userPassword" class="block text-sm font-medium text-primary-dark mb-1">Contrasena</label>
              <div class="relative">
                <input type="password" id="userPassword" minlength="8"
                       class="w-full px-4 py-3 pr-12 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                       placeholder="Dejar vacio para no cambiar" />
                <button type="button" class="toggle-password absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors" data-target="userPassword">
                  <span class="material-symbols-outlined text-xl">visibility</span>
                </button>
              </div>
              <p class="mt-1 text-xs text-slate-400">Min. 8 caracteres, debe incluir mayusculas, minusculas, numeros y caracteres especiales</p>
            </div>
            <div id="passwordConfirmFields" class="hidden">
              <label for="userPasswordConfirm" class="block text-sm font-medium text-primary-dark mb-1">Confirmar Contrasena</label>
              <div class="relative">
                <input type="password" id="userPasswordConfirm" minlength="8"
                       class="w-full px-4 py-3 pr-12 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                       placeholder="Escribe la contrasena de nuevo" />
                <button type="button" class="toggle-password absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors" data-target="userPasswordConfirm">
                  <span class="material-symbols-outlined text-xl">visibility</span>
                </button>
              </div>
            </div>
            <div>
              <label for="userRole" class="block text-sm font-medium text-primary-dark mb-1">Rol</label>
              <select id="userRole"
                      class="w-full px-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm bg-white">
                <option value="user">Usuario</option>
                <option value="instructor">Instructor</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div id="positionField" class="hidden">
              <label for="userPosition" class="block text-sm font-medium text-primary-dark mb-1">Cargo / Titulo</label>
              <input type="text" id="userPosition" maxlength="255"
                     class="w-full px-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                     placeholder="Ej: Instructora de Kundalini Yoga" />
              <label for="userPositionEn" class="block text-xs font-medium text-accent-teal mt-2 mb-1">Position (EN)</label>
              <input type="text" id="userPositionEn" maxlength="255"
                     class="w-full px-4 py-3 rounded-2xl border border-slate-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors text-sm"
                     placeholder="E.g.: Kundalini Yoga Instructor" />
            </div>
            <div id="userFormError" class="hidden p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm"></div>
            <div class="flex gap-3 pt-2">
              <button type="button" id="cancelUserBtn" class="flex-1 py-3 rounded-2xl border border-slate-200 font-medium text-slate-600 hover:bg-slate-50 transition-colors" data-i18n="modal.cancel">Cancelar</button>
              <button type="submit" id="saveUserBtn" class="flex-1 py-3 rounded-2xl bg-primary-dark text-white font-bold hover:bg-primary transition-colors" data-i18n="modal.save">Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </main>

    {{> footer}}

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
